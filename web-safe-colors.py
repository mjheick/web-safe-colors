import sys
import os.path
import math
from PIL import Image

# colors
colors = [[0, 0, 0], [0, 0, 102], [0, 0, 153], [0, 0, 204], [0, 0, 255], [0, 0, 51], [0, 102, 0], [0, 102, 102], [0, 102, 153], [0, 102, 204], [0, 102, 255], [0, 102, 51], [0, 153, 0], [0, 153, 102], [0, 153, 153], [0, 153, 204], [0, 153, 255], [0, 153, 51], [0, 204, 0], [0, 204, 102], [0, 204, 153], [0, 204, 204], [0, 204, 255], [0, 204, 51], [0, 255, 0], [0, 255, 102], [0, 255, 153], [0, 255, 204], [0, 255, 255], [0, 255, 51], [0, 51, 0], [0, 51, 102], [0, 51, 153], [0, 51, 204], [0, 51, 255], [0, 51, 51], [102, 0, 0], [102, 0, 102], [102, 0, 153], [102, 0, 204], [102, 0, 255], [102, 0, 51], [102, 102, 0], [102, 102, 102], [102, 102, 153], [102, 102, 204], [102, 102, 255], [102, 102, 51], [102, 153, 0], [102, 153, 102], [102, 153, 153], [102, 153, 204], [102, 153, 255], [102, 153, 51], [102, 204, 0], [102, 204, 102], [102, 204, 153], [102, 204, 204], [102, 204, 255], [102, 204, 51], [102, 255, 0], [102, 255, 102], [102, 255, 153], [102, 255, 204], [102, 255, 255], [102, 255, 51], [102, 51, 0], [102, 51, 102], [102, 51, 153], [102, 51, 204], [102, 51, 255], [102, 51, 51], [153, 0, 0], [153, 0, 102], [153, 0, 153], [153, 0, 204], [153, 0, 255], [153, 0, 51], [153, 102, 0], [153, 102, 102], [153, 102, 153], [153, 102, 204], [153, 102, 255], [153, 102, 51], [153, 153, 0], [153, 153, 102], [153, 153, 153], [153, 153, 204], [153, 153, 255], [153, 153, 51], [153, 204, 0], [153, 204, 102], [153, 204, 153], [153, 204, 204], [153, 204, 255], [153, 204, 51], [153, 255, 0], [153, 255, 102], [153, 255, 153], [153, 255, 204], [153, 255, 255], [153, 255, 51], [153, 51, 0], [153, 51, 102], [153, 51, 153], [153, 51, 204], [153, 51, 255], [153, 51, 51], [204, 0, 0], [
    204, 0, 102], [204, 0, 153], [204, 0, 204], [204, 0, 255], [204, 0, 51], [204, 102, 0], [204, 102, 102], [204, 102, 153], [204, 102, 204], [204, 102, 255], [204, 102, 51], [204, 153, 0], [204, 153, 102], [204, 153, 153], [204, 153, 204], [204, 153, 255], [204, 153, 51], [204, 204, 0], [204, 204, 102], [204, 204, 153], [204, 204, 204], [204, 204, 255], [204, 204, 51], [204, 255, 0], [204, 255, 102], [204, 255, 153], [204, 255, 204], [204, 255, 255], [204, 255, 51], [204, 51, 0], [204, 51, 102], [204, 51, 153], [204, 51, 204], [204, 51, 255], [204, 51, 51], [255, 0, 0], [255, 0, 102], [255, 0, 153], [255, 0, 204], [255, 0, 255], [255, 0, 51], [255, 102, 0], [255, 102, 102], [255, 102, 153], [255, 102, 204], [255, 102, 255], [255, 102, 51], [255, 153, 0], [255, 153, 102], [255, 153, 153], [255, 153, 204], [255, 153, 255], [255, 153, 51], [255, 204, 0], [255, 204, 102], [255, 204, 153], [255, 204, 204], [255, 204, 255], [255, 204, 51], [255, 255, 0], [255, 255, 102], [255, 255, 153], [255, 255, 204], [255, 255, 255], [255, 255, 51], [255, 51, 0], [255, 51, 102], [255, 51, 153], [255, 51, 204], [255, 51, 255], [255, 51, 51], [51, 0, 0], [51, 0, 102], [51, 0, 153], [51, 0, 204], [51, 0, 255], [51, 0, 51], [51, 102, 0], [51, 102, 102], [51, 102, 153], [51, 102, 204], [51, 102, 255], [51, 102, 51], [51, 153, 0], [51, 153, 102], [51, 153, 153], [51, 153, 204], [51, 153, 255], [51, 153, 51], [51, 204, 0], [51, 204, 102], [51, 204, 153], [51, 204, 204], [51, 204, 255], [51, 204, 51], [51, 255, 0], [51, 255, 102], [51, 255, 153], [51, 255, 204], [51, 255, 255], [51, 255, 51], [51, 51, 0], [51, 51, 102], [51, 51, 153], [51, 51, 204], [51, 51, 255], [51, 51, 51]]

# parameters
if len(sys.argv) == 1:
    print("parameter 1 needs to be an image file")
    quit()
if len(sys.argv) == 2:
    output_filename = "output.png"
if len(sys.argv) > 2:
    output_filename = sys.argv[2]
input_filename = sys.argv[1]

if not os.path.isfile(input_filename):
    print(f"File {input_filename} does not exist")
    quit()

try:
    src = Image.open(input_filename)
    dst = Image.new("RGBA", src.size)
except:
    print(f"{input_filename} is not a readable image")
    quit()

for y in range(0, src.size[1]):
    for x in range(0, src.size[0]):
        pxl = src.getpixel((x, y))
        if (len(pxl) == 3):
            red = pxl[0]
            grn = pxl[1]
            blu = pxl[2]
        else:
            print(f"do not support pixel format")
            quit()
        distance = 255
        new_pxl = (0, 0, 0)
        for clrs in colors:
            c_red = clrs[0]
            c_grn = clrs[1]
            c_blu = clrs[2]
            clr_distance = math.sqrt(
                math.pow(c_red - red, 2) + math.pow(c_grn - grn, 2) + math.pow(c_blu - blu, 2))
            if (clr_distance < distance):
                distance = clr_distance
                new_pxl = (c_red, c_grn, c_blu)
        dst.putpixel((x, y), new_pxl)

dst.save(output_filename)
